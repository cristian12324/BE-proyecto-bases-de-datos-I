<div class="tratamiento-list-container">
  <h2>Lista de Tratamientos</h2>

  <ul>
    <li *ngFor="let t of tratamientos">
      <div class="tratamiento-item">
        <div class="tratamiento-info">
          {{ t.descripcion }} — {{ t.observaciones }} — {{ t.fechaRegistro | date:'shortDate' }}
          <span *ngIf="t.cita">
            — {{ getNombrePaciente(t.cita) }} — {{ getNombreServicio(t.cita) }}
          </span>
        </div>
        <div class="button-group">
          <button (click)="editar(t)">Editar</button>
          <button (click)="eliminar(t.idTratamiento)">Eliminar</button>
        </div>
      </div>
    </li>
  </ul>

  <div class="tratamiento-form" *ngIf="tratamiento">
    <h3>{{ tratamiento.idTratamiento ? 'Editar Tratamiento' : 'Nuevo Tratamiento' }}</h3>

    <form (ngSubmit)="guardar()">
      <div>
        <label>Descripción:</label>
        <input type="text" [(ngModel)]="tratamiento.descripcion" name="descripcion" placeholder="Descripción" required />
      </div>

      <div>
        <label>Observaciones:</label>
        <textarea [(ngModel)]="tratamiento.observaciones" name="observaciones" placeholder="Observaciones" required></textarea>
      </div>

      <div>
        <label>Fecha de Registro:</label>
        <input type="date" [(ngModel)]="tratamiento.fechaRegistro" name="fechaRegistro" required />
      </div>

      <div>
        <label>Cita:</label>
        <select [(ngModel)]="tratamiento.cita" name="cita" required>
          <option *ngFor="let c of citas" [ngValue]="c">
            {{ getNombrePaciente(c) }} — {{ getNombreServicio(c) }} — {{ c.fecha | date:'shortDate' }} {{ c.hora }}
          </option>
        </select>
      </div>

      <div class="button-group">
        <button type="submit">{{ tratamiento.idTratamiento ? 'Actualizar' : 'Guardar' }}</button>
        <button type="button" (click)="cancelar()">Cancelar</button>
      </div>
    </form>

    <p *ngIf="mensaje" class="mensaje">{{ mensaje }}</p>
  </div>
</div>
